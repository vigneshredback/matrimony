
<!-- Your existing content goes here -->

<div class="all-list-sh">
    <ul id="profile-list">
        {% for item in profiles %}
        <li>
            <div class="all-pro-box user-avil-onli" data-useravil="avilyes" data-aviltxt="Available online">
                <div class="pro-img">
                    <a href="{% url 'profile_detail' item.id %}">
                        <img src="{{item.image1}}" alt="">
                    </a>
                    <div class="pro-ave" title="User currently available">
                        <span class="pro-ave-yes"></span>
                    </div>
                    <div class="pro-avl-status">
                        <h5>Available Online</h5>
                    </div>
                </div>
                <div class="pro-detail">
                    <h4><a href="{% url 'profile_detail' item.id %}">{{ item.user.name }}</a></h4>
                    <div class="pro-bio">
                        <span>{{ item.degree }}</span>
                        <span>{{ item.profession }}</span>
                        <span>Age: {{ item.age }}</span>
                        <span>Height: {{ item.height }}</span>
                    </div>
                    <div class="links">
                        <span class="cta-chat">Chat now</span>
                        <a href="#!">WhatsApp</a>
                        <a href="#!" class="cta cta-sendint" data-bs-toggle="modal" data-bs-target="#sendInter">Send interest</a>
                        <a href="profile-details.html">More details</a>
                    </div>
                </div>
                <span class="enq-sav" data-toggle="tooltip" title="Click to save this profile.">
                    <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                </span>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<div id="loading" style="display: none;">Loading...</div>

<script>
    let page = 2;  // Start with page 2 because page 1 is already loaded
    let loading = false;
    let hasNextPage = true;

    window.onscroll = function() {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500 && !loading && hasNextPage) {
            loadMoreProfiles();
        }
    };

    function loadMoreProfiles() {
        loading = true;
        document.getElementById('loading').style.display = 'block';

        fetch('/allprofiles/?page=' + page, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            const profileList = document.getElementById('profile-list');
            data.profiles.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="all-pro-box user-avil-onli" data-useravil="avilyes" data-aviltxt="Available online">
                        <div class="pro-img">
                            <a href="http://127.0.0.1:8000/profile-detail/${item.id}/">
                                <img src="${item.image1}" alt="${item.image1}">
                            </a>
                            <div class="pro-ave" title="User currently available">
                                <span class="pro-ave-yes"></span>
                            </div>
                            <div class="pro-avl-status">
                                <h5>Available Online</h5>
                            </div>
                        </div>
                        <div class="pro-detail">
                            <h4><a href="http://127.0.0.1:8000/profile-detail/${item.id}/">${item.name}</a></h4>
                            <div class="pro-bio">
                                <span>${item.degree}</span>
                                <span>${item.profession}</span>
                                <span>Age: ${item.age}</span>
                                <span>Height: ${item.height}</span>
                            </div>
                            <div class="links">
                                <span class="cta-chat">Chat now</span>
                                <a href="#!">WhatsApp</a>
                                <a href="#!" class="cta cta-sendint" data-bs-toggle="modal" data-bs-target="#sendInter">Send interest</a>
                                <a href="profile-details.html">More details</a>
                            </div>
                        </div>
                        <span class="enq-sav" data-toggle="tooltip" title="Click to save this profile.">
                            <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                        </span>
                    </div>
                `;
                profileList.appendChild(li);
            });

            page += 1;
            loading = false;
            document.getElementById('loading').style.display = 'none';
            hasNextPage = data.has_next;
        })
        .catch(() => {
            loading = false;
            document.getElementById('loading').style.display = 'none';
        });
    }
</script>

